 
    <!DOCTYPE html> 
    <html lang="en"> 
    <head> 
        <meta charset="UTF-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
        <title>Decision Tree Visualization</title> 
        <style> 
            body { font-family: Arial, sans-serif; text-align: center}
            .tree-container { display: flex; justify-content: center; margin-top: 20px}
            .node { border: 2px solid blue; border-radius: 100%; background-color: lightcyan; color: lightcyan ;display: inline-block;  position: absolute; width: 24px; height: 24px} 
            .square { position: absolute; transform: translate(14px, 14px); z-index: -1}
            .leaf { display: inline-block; font-weight: bolder; position: absolute; line-height: 24px}
            .d_r:after { content: ""; width: 100%; height: 100%; position: absolute; top: 0; left: 0; background: linear-gradient(to top right, transparent calc(50% - 1px), blue, transparent calc(50% + 1px))}
            .d_l:after { content: ""; width: 100%; height: 100%; position: absolute; top: 0; left: 0; background: linear-gradient(to top left, transparent calc(50% - 1px), blue, transparent calc(50% + 1px))}
            .tooltip { position: absolute; background-color: rgba(0, 0, 0, 0.8); color: white; padding: 8px; border-radius: 5px; white-space: nowrap; visibility: hidden; opacity: 0; transition: opacity 0.3s; font-size: 14px; width: fit-content}
            .t_l { transform: translate(35px, -5px)}
            .t_r { transform: translateX(-100%) translate(-8px, -5px)}
            .leaf_value{ display: inline-block; font-weight: bolder; position: absolute; line-height: 24px; transform: translate(6px, 30px)}
            #legend { display: flex; flex-wrap: wrap; gap: 8px; position: absolute; bottom: 3%; width: 100%; justify-content: center; font-family: sans-serif}
            .legend-item { display: flex; align-items: center; gap: 6px; margin-right: 12px }
            .color-box { width: 16px; height: 16px; border: 1px solid #000; box-sizing: border-box}
        </style> 
    </head> 
    <body> 
        <h1>SLBT Stratified Tree - Gender-based Loan Approval</h1> 
        <div class="tree-container" id="tree"></div> 

        <div id="tooltip" class="tooltip"></div>
        
        <script> 
            const treeData = {
    "isLeaf": 0,
    "feature": "income",
    "distribution": "approved=0.63, rejected=0.37",
    "distArray": [
        0.6266666666666667,
        0.37333333333333335
    ],
    "lift1": "female: (approved=1.47, rejected=0.21)\nmale: (approved=1.51, rejected=0.14)",
    "lift2": "female: (approved=0.52, rejected=1.8)\nmale: (approved=0.31, rejected=2.16)",
    "treshold": "female:[1, 2], male:[1, 2]",
    "position": 1,
    "gpi": 0.24977128074168015,
    "ppi": 0.22393424379649113,
    "impurity": 0.46791111111111094,
    "labels": 600,
    "labArray": [
        "approved",
        "rejected"
    ],
    "children": [
        {
            "isLeaf": 0,
            "feature": "credit_score",
            "distribution": "approved=0.8, rejected=0.2",
            "distArray": [
                0.7989556135770235,
                0.2010443864229765
            ],
            "lift1": "female: (approved=0.46, rejected=3.16)\nmale: (approved=0.56, rejected=2.77)",
            "lift2": "female: (approved=1.2, rejected=0.2)\nmale: (approved=1.21, rejected=0.15)",
            "treshold": "female:[0], male:[0]",
            "position": 2,
            "gpi": 0.3194287774380142,
            "ppi": 0.30910255545832444,
            "impurity": 0.32125108222157084,
            "labels": 383,
            "labArray": [
                "approved",
                "rejected"
            ],
            "children": [
                {
                    "isLeaf": 0,
                    "feature": "income",
                    "distribution": "approved=0.47, rejected=0.53",
                    "distArray": [
                        0.47107438016528924,
                        0.5289256198347108
                    ],
                    "lift1": "female: (approved=1.13, rejected=0.88)\nmale: (approved=0.86, rejected=1.13)",
                    "lift2": "female: (approved=0.62, rejected=1.34)\nmale: (approved=0.86, rejected=1.13)",
                    "treshold": "female:[2], male:[2]",
                    "position": 4,
                    "gpi": 0.30106740746683786,
                    "ppi": 0.30106740746683763,
                    "impurity": 0.4983266170343556,
                    "labels": 121,
                    "labArray": [
                        "approved",
                        "rejected"
                    ],
                    "children": [
                        {
                            "isLeaf": 1,
                            "distribution": "approved=0.85, rejected=0.15",
                            "distArray": [
                                0.8536585365853658,
                                0.14634146341463414
                            ],
                            "position": 8,
                            "value": "approved",
                            "impurity": 0.24985127900059492,
                            "labels": 41,
                            "labArray": [
                                "approved",
                                "rejected"
                            ],
                            "gcr": "approved=1.36, rejected=0.39"
                        },
                        {
                            "isLeaf": 1,
                            "distribution": "approved=0.28, rejected=0.72",
                            "distArray": [
                                0.275,
                                0.725
                            ],
                            "position": 9,
                            "value": "rejected",
                            "impurity": 0.39874999999999994,
                            "labels": 80,
                            "labArray": [
                                "approved",
                                "rejected"
                            ],
                            "gcr": "approved=0.44, rejected=1.94"
                        }
                    ]
                },
                {
                    "isLeaf": 1,
                    "distribution": "approved=0.95, rejected=0.05",
                    "distArray": [
                        0.950381679389313,
                        0.04961832061068702
                    ],
                    "position": 5,
                    "value": "approved",
                    "impurity": 0.09431268574092423,
                    "labels": 262,
                    "labArray": [
                        "approved",
                        "rejected"
                    ],
                    "gcr": "approved=1.52, rejected=0.13"
                }
            ]
        },
        {
            "isLeaf": 0,
            "feature": "credit_score",
            "distribution": "approved=0.32, rejected=0.68",
            "distArray": [
                0.3225806451612903,
                0.6774193548387096
            ],
            "lift1": "female: (approved=2.33, rejected=0.37)\nmale: (approved=2.06, rejected=0.49)",
            "lift2": "female: (approved=0.2, rejected=1.38)\nmale: (approved=0.14, rejected=1.41)",
            "treshold": "female:[2], male:[2]",
            "position": 3,
            "gpi": 0.2797843968896599,
            "ppi": 0.2158805702198756,
            "impurity": 0.4370447450572321,
            "labels": 217,
            "labArray": [
                "approved",
                "rejected"
            ],
            "children": [
                {
                    "isLeaf": 1,
                    "distribution": "approved=0.62, rejected=0.38",
                    "distArray": [
                        0.618421052631579,
                        0.3815789473684211
                    ],
                    "position": 6,
                    "value": "approved",
                    "impurity": 0.4719529085872576,
                    "labels": 76,
                    "labArray": [
                        "approved",
                        "rejected"
                    ],
                    "gcr": "approved=0.99, rejected=1.02"
                },
                {
                    "isLeaf": 1,
                    "distribution": "approved=0.16, rejected=0.84",
                    "distArray": [
                        0.16312056737588654,
                        0.8368794326241135
                    ],
                    "position": 7,
                    "value": "rejected",
                    "impurity": 0.27302449574971077,
                    "labels": 141,
                    "labArray": [
                        "approved",
                        "rejected"
                    ],
                    "gcr": "approved=0.26, rejected=2.24"
                }
            ]
        }
    ]
}; 
            const plotData = {
    "l_c": 0.875,
    "r_c": 0.75,
    "depth": 3,
    "colors": [
        "#FF6384",
        "#36A2EB",
        "#FFCE56",
        "#4CAF50",
        "#9966FF",
        "#D81B60",
        "#00ACC1",
        "#8D6E63",
        "#FF9800"
    ],
    "labels": [
        "approved",
        "rejected"
    ]
};
            
            function iter(node, top, left, d, h) {
                if(node.isLeaf == 1){
                    let nodeElement = document.createElement("div")
                    nodeElement.classList.add("leaf")
                    nodeElement.style.left = left + "%"
                    nodeElement.style.top = top + "%"

                    nodeElement.onmouseover = function(event) { showTooltip(event, node, top, left); };
                    nodeElement.onmouseout = hideTooltip;
                    
                    let nodeValue = document.createElement("div")
                    nodeValue.classList.add("leaf_value")
                    nodeValue.style.left = left + "%"
                    nodeValue.style.top = top + "%"
                    nodeValue.innerText = node.value

                    let canvas = document.createElement("canvas");
                    canvas.width = 36;
                    canvas.height = 36;
                    canvas.style.position = "absolute";
                    canvas.style.top = "-6px";
                    canvas.style.left = "-6px";
                    nodeElement.appendChild(canvas);

                    tree = document.getElementById("tree")
                    tree.appendChild(nodeElement)
                    tree.appendChild(nodeValue)

                    if (node.distribution) {
                        drawPieChart(canvas, node.distArray, node.labArray);
                    }
                    return
                }

                let nodeElement = document.createElement("div")
                nodeElement.classList.add("node")
                nodeElement.style.left = left + "%"
                nodeElement.style.top = top + "%"
                nodeElement.onmouseover = function(event) { showTooltip(event, node, top, left); };
                nodeElement.onmouseout = hideTooltip;

                let lbranchElement = document.createElement("div")
                lbranchElement.classList.add("square")
                lbranchElement.classList.add("d_l")
                lbranchElement.style.right = (100-left) + "%"
                lbranchElement.style.top = top + "%"
                lbranchElement.style.height = h + "%"
                lbranchElement.style.width = d/2 + "%"

                let rbranchElement = document.createElement("div")
                rbranchElement.classList.add("square")
                rbranchElement.classList.add("d_r")
                rbranchElement.style.left = left + "%"
                rbranchElement.style.top = top + "%"
                rbranchElement.style.height = h + "%"
                rbranchElement.style.width = d/2 + "%"

                let canvas = document.createElement("canvas");
                canvas.width = 36;
                canvas.height = 36;
                canvas.style.position = "absolute";
                canvas.style.top = "-6px";
                canvas.style.left = "-6px";
                nodeElement.appendChild(canvas);

                tree = document.getElementById("tree")
                tree.appendChild(nodeElement)
                tree.appendChild(lbranchElement)
                tree.appendChild(rbranchElement)

                if (node.distribution) {
                    drawPieChart(canvas, node.distArray, node.labArray);
                }

                iter(node.children[0], top+h, left-d/2, d/2, h)
                iter(node.children[1], top+h, left+d/2, d/2, h)
                return
            }

            // Legend
            const legendContainer = document.createElement('div');
            legendContainer.id = 'legend';

            for (let i = 0; i < plotData.labels.length; i++) {
                const item = document.createElement('div');
                item.className = 'legend-item';

                const colorBox = document.createElement('div');
                colorBox.className = 'color-box';
                colorBox.style.backgroundColor = plotData.colors[i];

                const label = document.createElement('span');
                label.textContent = plotData.labels[i];

                item.appendChild(colorBox);
                item.appendChild(label);
                legendContainer.appendChild(item);
            }
            document.body.appendChild(legendContainer);

            function drawPieChart(canvas, distArray, labArray) {
                let ctx = canvas.getContext("2d");
                let total = distArray.reduce((sum, val) => sum + val, 0);
                let startAngle = 0;

                distArray.forEach((value, index) => {
                    let sliceAngle = (value / total) * 2 * Math.PI;

                    ctx.beginPath();
                    ctx.moveTo(18, 18);
                    ctx.arc(18, 18, 16, startAngle, startAngle + sliceAngle);
                    ctx.closePath();
                    plotData.labels.forEach((valueLab, indexLab) => {
                        if(valueLab == labArray[index]) {
                            ctx.fillStyle = plotData.colors[indexLab % plotData.colors.length];
                        }
                    })
                    ctx.fill();

                    startAngle += sliceAngle;
                });

                ctx.beginPath();
                ctx.arc(18, 18, 17, 0, 2 * Math.PI);
                ctx.strokeStyle = "blue";
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            function showTooltip(event, node, top, left) {
                tooltip = document.getElementById('tooltip')

                if(node.isLeaf == 1){
                    tooltip.innerText = "Id: " + node.position + "\nN: " + node.labels + "\nClass distribution: [" + node.distribution +  "]\nGCR: [" + node.gcr + "]\nImpurty: " + node.impurity.toFixed(3) + "\nPrediction: "+ node.value;
                } else {
                    if(node.lift1 && node.lift2) {
                        tooltip.innerText = "Id: " + node.position + "\nN: " + node.labels +  "\nClass distribution: [" + node.distribution + "]\nLIFT left: [" + node.lift1 + "]\nLIFT right: [" + node.lift2 + "]\nFeature: " + node.feature + "\nThreshold left: [" + node.treshold + "]\nGpi: " + node.gpi.toFixed(3) + "\nPpi: " + node.ppi.toFixed(3)  + "\nImpurty: " + node.impurity.toFixed(3);
                    } else {
                        tooltip.innerText = "Id: " + node.position + "\nN: " + node.labels +  "\nClass distribution: [" + node.distribution + "]\nFeature: " + node.feature + "\nThreshold left: [" + node.treshold + "]\nGpi: " + node.gpi.toFixed(3) + "\nPpi: " + node.ppi.toFixed(3)  + "\nImpurty: " + node.impurity.toFixed(3);
                    }
                }

                if(left > 50){
                    tooltip.style.left = left + "%"
                    tooltip.style.top = top + "%"
                    tooltip.classList.add("t_r")
                } else {
                    tooltip.style.left = left + "%"
                    tooltip.style.top = top + "%"
                    tooltip.classList.add("t_l")
                }

                tooltip.style.visibility = 'visible'
                tooltip.style.opacity = 1
            }

            function hideTooltip() {
                tooltip = document.getElementById('tooltip')
                tooltip.classList.remove("t_r")
                tooltip.classList.remove("t_l")
                tooltip.style.visibility = 'hidden'
                tooltip.style.opacity = 0
            }

            d = 80/(plotData.l_c+plotData.r_c);
            h = 65/(plotData.depth);

            iter(treeData, 15, 10+d*plotData.l_c, d, h)
        </script> 
    </body>
    </html> 
    